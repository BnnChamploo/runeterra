# 班德尔密林 - 符文大陆里宇宙 - 功能说明

## 🎯 项目定位

这是一个专为**论坛体同人创作**设计的BBS系统，支持展示模式和编辑模式，方便作者创作拟真的论坛体作品。系统完全模拟真实论坛的显示效果，让创作论坛体变得简单有趣。

## ✨ 已实现功能

### 1. 板块系统

#### 主板块和子板块结构
- ✅ **瓦罗兰广场** (plaza) - 主板块 🏛️
  - 聊天灌水 (plaza_chat_daily) 💧
  - 学徒交流 (plaza_summoner_academic) 📚
  - 出大事了·公告板 (plaza_news) 🪧
  - 活动 (plaza_activity) 🎡
- ✅ **八卦娱乐** (gossip) - 主板块 ☕
  - 约德尔大饭堂 (gossip_fan) 💊
  - 偶像明星 (gossip_star) 🫧
  - 818 (gossip_chat)
  - 爆破雷区 (gossip_bomb) 💣
  - 吃瓜码头 (gossip_melon) 🍉
- ✅ **情感专区** (emotion) - 主板块 🌙
  - 蘑菇树洞 (emotion_tree) 🍄
  - 恋爱分享 (emotion_love) 🐾
  - 情感咨询 (emotion_consult) 🦄
  - 相亲角 (emotion_match) 💞
- ✅ **生活市集** (life) - 主板块 🗺️
  - 二手交易 (life_trade) 💸
  - 招募队友 (life_team) 🍻
  - 租赁 (life_rental) 🏘️
  - 求助 (life_help) ❓

### 2. 用户系统

- ✅ 用户注册和登录
- ✅ **自动用户创建**：使用默认密码1234567登录时，如果用户不存在会自动创建
- ✅ 自定义头像和用户名
- ✅ **搜索用户功能**：发帖和回复时可以通过搜索快速查找用户
- ✅ **自定义用户名**：发帖和回复时可以使用自定义用户名（不存在会自动创建）
- ✅ **段位系统**（LOL段位）：
  - 坚韧黑铁 (1)
  - 英勇黄铜 (2)
  - 不屈白银 (3)
  - 荣耀黄金 (4)
  - 华贵铂金 (5)
  - 流光翡翠 (6)
  - 璀璨钻石 (7)
  - 超凡大师 (8)
  - 傲世宗师 (9)
  - 最强王者 (10)
- ✅ **头衔系统**：每个用户/帖子可以设置头衔（英雄默认头衔为空）
- ✅ **身份系统**：可以设置身份（如：版主，英雄默认身份为空）
- ✅ **记忆功能**：在同一个帖子中，如果某个用户回复过，再次选择该用户时会自动填充上次的值（身份、头衔、段位、地区、时间）

### 3. 发帖功能

- ✅ 发帖时可以选择用户（支持搜索）
- ✅ **自定义用户名**：可以使用自定义用户名发帖
- ✅ **匿名发帖**功能（匿名时隐藏头衔和身份）
- ✅ **自定义时间**（考虑到平行宇宙可能不适用诺克萨斯历，所以暂时自拟瓦罗兰历，格式：瓦罗兰历 YY-MM-DD HH:mm，如：瓦罗兰历 25-12-03 11:21）
- ✅ **地区显示**（艾欧尼亚、德玛西亚等）
- ✅ **图片上传**（支持多张，最大50MB）
- ✅ 显示浏览量、点赞数、评论数
- ✅ 显示用户头像、用户名、段位、头衔、身份
- ✅ 富文本编辑器（支持格式化、图片、链接等），**⚠️ 有时候会出现文本编辑框消失的情况，刷新一下就好了，所以建议编辑内容在别的地方输入好直接复制进去**
- ✅ 置顶功能

### 4. 回复功能

- ✅ 回复时可以选择用户（支持搜索）
- ✅ **自定义用户名**：可以使用自定义用户名回复
- ✅ **匿名回复**功能（匿名时隐藏头衔和身份）
- ✅ **引用回复**：可以引用其他楼层的回复，显示引用内容
- ✅ **自定义时间**（瓦罗兰历）
- ✅ **地区显示**
- ✅ **图片上传**（支持多张）
- ✅ **自定义楼层号**：可以手动设置楼层号，系统会自动按数字大小排序
- ✅ 显示用户头像、用户名、段位、头衔、身份
- ✅ 富文本编辑器
- ✅ **楼主标识**：如果回复者是楼主，会显示"楼主"标识（即使匿名也显示）

### 5. 编辑模式（核心功能）

- ✅ **展示模式/编辑模式切换**（在导航栏切换）
- ✅ **拖拽楼层排序**（在编辑模式下可以拖拽回复顺序，自动调整楼层号）
- ✅ **编辑帖子内容**：
  - 修改标题、内容
  - 选择/更改发帖人（支持搜索和自定义用户名）
  - 设置匿名
  - 修改时间、地区
  - 修改头衔、身份
  - 修改浏览量、点赞数、回复数
  - 设置置顶
- ✅ **编辑回复内容**：
  - 修改回复内容
  - 选择/更改回复人（支持搜索和自定义用户名）
  - 设置匿名
  - 修改时间、地区
  - 修改头衔、身份
  - 修改楼层号
  - 删除回复
- ✅ **批量保存**：一键保存所有更改

### 6. 显示功能

- ✅ 帖子列表显示所有信息（头像、用户名、段位、头衔、身份、地区、时间等）
- ✅ 帖子详情页完整显示
- ✅ 回复列表完整显示（支持引用显示）
- ✅ 瓦罗兰历时间显示
- ✅ 地区IP显示
- ✅ 匿名时隐藏用户信息（头衔、身份）
- ✅ 英雄默认头衔和身份为空
- ✅ **@提及高亮**：在帖子内容中使用@用户名会高亮显示（仅文字颜色，无背景）
- ✅ **楼主标识**：帖子详情页和回复中会显示"楼主"标识

### 7. 其他功能

- ✅ **点赞/收藏数显示** - 在展示模式下显示点赞数（收藏数），在编辑模式下可以修改数字
- ✅ 图片预览和删除
- ✅ 响应式设计
- ✅ 深色/浅色主题切换
- ✅ 用户排行榜
- ✅ **一键清除所有帖子**：在主题切换下拉菜单中提供清除功能（需要登录）
- ✅ **默认头像系统**：支持从 `client/public/avatar/` 目录加载英雄头像（支持jpg、jpeg、webp格式）

## 🎨 使用说明

### 展示模式（正常论坛模式）

1. 浏览帖子列表
2. 查看帖子详情
3. 发表回复（可以选择用户、设置匿名、自定义时间等）
4. 点赞帖子
5. 使用@提及其他用户

### 编辑模式（创作模式）

1. 登录后，点击导航栏的"展示模式"按钮切换到"编辑模式"
2. 进入帖子详情页
3. 可以：
   - 编辑帖子信息
   - 拖拽回复楼层调整顺序（自动调整楼层号）
   - 编辑每个回复的内容
   - 选择不同的用户发表回复（支持搜索和自定义用户名）
   - 修改时间、地区、头衔、身份等信息
   - 删除回复
4. 点击"保存所有更改"保存修改

### 发帖时的字段说明

- **发帖人**：
  - 选择用户：从数据库中选择已存在的用户（支持搜索）
  - 自定义名称：输入自定义用户名（不存在会自动创建）
- **匿名**：勾选后显示为"匿名用户"，隐藏头衔和身份
- **时间**：留空使用当前时间，或填写瓦罗兰历时间（格式：YY-MM-DD HH:mm，如：25-12-03 11:21）
- **地区**：选择英雄所在地区（艾欧尼亚、德玛西亚等）
- **头衔**：填写头衔（英雄默认头衔为空）
- **身份**：填写身份（如：版主，英雄默认身份为空）

### 回复时的字段说明

- **回复人**：
  - 选择用户：从数据库中选择已存在的用户（支持搜索）
  - 自定义名称：输入自定义用户名（不存在会自动创建）
- **匿名**：勾选后显示为"匿名用户"，隐藏头衔和身份
- **时间**：留空使用当前时间，或填写瓦罗兰历时间
- **地区**：选择英雄所在地区
- **头衔**：填写头衔
- **身份**：填写身份
- **楼层数**：可以自定义楼层号，留空则自动计数
- **引用回复**：点击其他楼层的"回复"按钮可以引用该楼层的内容

### 记忆功能说明

在同一个帖子中，如果某个用户回复过，再次选择该用户时会自动填充：
- 身份
- 头衔
- 段位
- 地区
- 时间

这样可以快速复用之前的设置，提高创作效率。

## 📝 创作建议

1. **先创建用户**：
   - 在注册页面创建各个英雄和角色的账号
   - 或使用默认密码1234567登录（不存在用户会自动创建）

2. **设置用户信息**：
   - 在个人资料页面设置每个用户的头像、段位、头衔、身份

3. **添加头像文件**：
   - 将英雄头像文件（jpg/jpeg/webp格式）放入 `client/public/avatar/` 目录
   - 文件名使用英雄的中文名或英文名（如：`泰达米尔.jpg` 或 `Tryndamere.jpg`）
   - 系统会自动匹配并显示

4. **切换到编辑模式**：
   - 开始创作时切换到编辑模式

5. **创建帖子**：
   - 在编辑模式下创建帖子，可以手动填写所有信息
   - 使用自定义用户名功能可以快速创建新角色

6. **添加回复**：
   - 在编辑模式下添加回复，可以自由选择用户、设置时间、引用其他回复等
   - 使用记忆功能可以快速复用之前的设置

7. **调整顺序**：
   - 通过拖拽调整回复顺序，系统会自动调整楼层号

8. **保存更改**：
   - 完成编辑后保存所有更改

9. **切换到展示模式**：
   - 查看最终效果

10. **清除数据**：
    - 如果需要重新开始，可以使用"清除所有帖子"功能（在主题切换下拉菜单中）

## 🔧 技术实现

- **后端**：Node.js + Express + SQLite
- **前端**：React + Vite + Tailwind CSS
- **拖拽**：@dnd-kit
- **图片上传**：Multer
- **认证**：JWT
- **富文本编辑**：ReactQuill
- **用户搜索**：自定义 SearchableSelect 组件

## 📌 注意事项

1. **编辑模式**需要登录才能使用
2. **图片上传限制**：
   - 头像：单张最大5MB
   - 帖子图片：单张最大50MB
3. **匿名发帖/回复**时，用户信息（头衔、身份）会被隐藏
4. **英雄用户**的默认头衔和身份为空，需要在发帖/回复时手动填写
5. **默认登录密码**为1234567，不存在用户会自动创建
6. **瓦罗兰历时间格式**：瓦罗兰历 YY-MM-DD HH:mm（如：瓦罗兰历 25-12-03 11:21）
7. **头像文件**应放在 `client/public/avatar/` 目录，支持jpg、jpeg、webp格式
8. **清除所有帖子**功能会删除所有帖子、回复和点赞数据，请谨慎使用
9. **自定义楼层号**时，系统会按数字大小排序，不是按创建时间
10. **引用回复**时，引用的内容会显示在回复中，用边框区分

## 🎉 特色功能

- **拟真度高**：完全模拟真实论坛的显示效果
- **创作友好**：编辑模式让创作论坛体变得简单
- **信息丰富**：支持显示头像、段位、头衔、身份、地区、时间等完整信息
- **灵活编辑**：可以自由调整楼层顺序、修改内容、选择用户
- **智能搜索**：用户选择支持搜索功能，快速查找用户
- **记忆功能**：同一帖子中，选择已回复过的用户会自动填充上次的值
- **引用回复**：支持引用其他楼层的回复，显示引用内容
- **楼主标识**：自动识别并显示楼主标识（即使匿名也显示）
- **自定义用户名**：发帖和回复时可以使用自定义用户名，不存在会自动创建
- **一键清除**：方便重新开始创作

## 🎨 头像系统

### 默认头像
- 头像文件应放在 `client/public/avatar/` 目录
- 支持格式：jpg、jpeg、webp
- 文件名可以使用英雄的中文名或英文名
- 系统会按以下顺序尝试加载：
  1. 中文名.jpg
  2. 中文名.jpeg
  3. 中文名.webp
  4. 英文名.jpg
  5. 英文名.jpeg
  6. 英文名.webp
- 如果所有尝试都失败，会显示首字母fallback

### 上传头像
- 用户可以在个人资料页面上传自定义头像
- 上传的头像保存在 `server/uploads/avatars/` 目录

祝你创作愉快！欢迎来到班德尔密林！✨
