# 班德尔密林 - 符文大陆里宇宙

一个专为**论坛体同人创作**设计的BBS系统，支持展示模式和编辑模式，方便作者创作拟真的论坛体作品。用户可以扮演英雄联盟中的英雄或瓦罗兰大陆的居民，在论坛中分享见闻、讨论话题、进行交易等。

## 🎯 项目定位

这是一个专为**论坛体同人创作**设计的BBS系统，支持展示模式和编辑模式，方便作者创作拟真的论坛体作品。系统完全模拟真实论坛的显示效果，让创作论坛体变得简单有趣。

## ✨ 功能特性

### 核心功能
- ✅ **展示模式/编辑模式切换** - 在导航栏切换，编辑模式支持完整的内容编辑
- ✅ **拖拽楼层排序** - 在编辑模式下可以拖拽回复顺序，自动调整楼层号
- ✅ **自定义楼层号** - 可以手动设置回复的楼层号
- ✅ **引用回复功能** - 回复时可以引用其他楼层的回复内容
- ✅ **@提及高亮** - 在帖子内容中使用@用户名会高亮显示
- ✅ **楼主标识** - 帖子详情页和回复中会显示"楼主"标识
- ✅ **一键清除所有帖子** - 在主题切换下拉菜单中提供清除功能

### 用户系统
- ✅ 用户注册和登录（默认密码：1234567，不存在的用户使用默认密码登录会被自动注册）
- ✅ 自定义头像和用户名
- ✅ **搜索用户功能** - 发帖和回复时可以通过搜索快速查找用户
- ✅ **自定义用户名** - 发帖和回复时可以使用自定义用户名（不存在会自动创建）
- ✅ **段位系统**（LOL段位）：
  - 坚韧黑铁 (1)
  - 英勇黄铜 (2)
  - 不屈白银 (3)
  - 荣耀黄金 (4)
  - 华贵铂金 (5)
  - 流光翡翠 (6)
  - 璀璨钻石 (7)
  - 超凡大师 (8)
  - 傲世宗师 (9)
  - 最强王者 (10)
- ✅ **头衔系统** - 每个用户/帖子可以设置头衔（英雄默认头衔为空）
- ✅ **身份系统** - 可以设置身份（如：版主，英雄默认身份为空）
- ✅ **记忆功能** - 在同一个帖子中，如果某个用户回复过，再次选择该用户时会自动填充上次的值

### 发帖功能
- ✅ 发帖时可以选择用户（支持搜索）
- ✅ **匿名发帖**功能（匿名时隐藏头衔和身份，段位默认为黑铁）
- ✅ **自定义时间**（瓦罗兰历格式：瓦罗兰历 YY-MM-DD HH:mm）
- ✅ **地区显示**（艾欧尼亚、德玛西亚等）
- ✅ **图片上传**（支持多张，未测试）
- ✅ 显示浏览量、点赞数、评论数
- ✅ 显示用户头像、用户名、段位、头衔、身份
- ✅ 富文本编辑器（支持格式化、图片、链接等），**⚠️ 有时候会出现文本编辑框消失的情况，刷新一下就好了，所以建议编辑内容在别的地方输入好直接复制进去**

### 回复功能
- ✅ 回复时可以选择用户（支持搜索）
- ✅ **匿名回复**功能（匿名时隐藏头衔和身份）
- ✅ **引用回复** - 可以引用其他楼层的回复
- ✅ **自定义时间**（瓦罗兰历）
- ✅ **地区显示**
- ✅ **图片上传**（支持多张）
- ✅ **自定义楼层号** - 可以手动设置楼层号，系统会自动排序
- ✅ 显示用户头像、用户名、段位、头衔、身份
- ✅ 富文本编辑器

### 编辑模式（核心功能）
- ✅ **展示模式/编辑模式切换**（在导航栏切换）
- ✅ **拖拽楼层排序** - 拖拽后自动调整楼层号
- ✅ **编辑帖子内容**：
  - 修改标题、内容
  - 选择/更改发帖人（支持搜索和自定义用户名）
  - 设置匿名
  - 修改时间、地区
  - 修改头衔、身份
  - 修改浏览量、点赞数、回复数
  - 设置置顶
- ✅ **编辑回复内容**：
  - 修改回复内容
  - 选择/更改回复人（支持搜索和自定义用户名）
  - 设置匿名
  - 修改时间、地区
  - 修改头衔、身份
  - 修改楼层号
  - 删除回复
- ✅ **批量保存** - 一键保存所有更改

### 板块系统

#### 主板块和子板块结构
- ✅ **瓦罗兰广场** (plaza) - 主板块 🏛️
  - 聊天灌水 (plaza_chat_daily) 💧
  - 学徒交流 (plaza_summoner_academic) 📚
  - 出大事了·公告板 (plaza_news) 🪧
  - 活动 (plaza_activity) 🎡
- ✅ **八卦娱乐** (gossip) - 主板块 ☕
  - 约德尔大饭堂 (gossip_fan) 💊
  - 偶像明星 (gossip_star) 🫧
  - 818 (gossip_chat)
  - 爆破雷区 (gossip_bomb) 💣
  - 吃瓜码头 (gossip_melon) 🍉
- ✅ **情感专区** (emotion) - 主板块 🌙
  - 蘑菇树洞 (emotion_tree) 🍄
  - 恋爱分享 (emotion_love) 🐾
  - 情感咨询 (emotion_consult) 🦄
  - 相亲角 (emotion_match) 💞
- ✅ **生活市集** (life) - 主板块 🗺️
  - 二手交易 (life_trade) 💸
  - 招募队友 (life_team) 🍻
  - 租赁 (life_rental) 🏘️
  - 求助 (life_help) ❓

### 显示功能
- ✅ 帖子列表显示所有信息（头像、用户名、段位、头衔、身份、地区、时间等）
- ✅ 帖子详情页完整显示
- ✅ 回复列表完整显示（支持引用显示）
- ✅ 瓦罗兰历时间显示
- ✅ 地区IP显示
- ✅ 匿名时隐藏用户信息
- ✅ 英雄默认头衔和身份为空

### 其他功能
- ✅ **点赞/收藏数显示** - 在展示模式下显示点赞数（收藏数），在编辑模式下可以修改
- ✅ 图片预览和删除
- ✅ 响应式设计
- ✅ 深色/浅色主题切换

## 技术栈

### 后端
- Node.js + Express
- SQLite 数据库
- JWT 身份验证
- Multer 文件上传
- bcrypt 密码加密

### 前端
- React 18
- React Router
- Tailwind CSS
- Axios
- Vite
- ReactQuill（富文本编辑器）
- @dnd-kit（拖拽排序）

## 安装和运行

### 1. 安装依赖

```bash
# 安装根目录依赖
npm install

# 安装后端依赖
cd server
npm install

# 安装前端依赖
cd ../client
npm install
```

或者使用一键安装：

```bash
npm run install-all
```

### 2. 运行项目

#### 方式一：分别运行（推荐开发）

```bash
# 终端1：启动后端服务器
cd server
npm start

# 终端2：启动前端开发服务器
cd client
npm run dev
```

#### 方式二：同时运行

```bash
# 在项目根目录运行
npm run dev
```

### 3. 访问应用

- 前端：http://localhost:3000
- 后端API：http://localhost:3001

## 项目结构

```
符文之地论坛/
├── server/              # 后端服务器
│   ├── index.js        # 服务器主文件
│   ├── heroes.js       # 英雄数据
│   ├── package.json    # 后端依赖
│   ├── runeterra.db    # SQLite数据库（自动生成）
│   └── uploads/        # 上传文件目录（自动生成）
│       ├── avatars/    # 用户头像
│       └── posts/      # 帖子图片
├── client/              # 前端应用
│   ├── src/
│   │   ├── components/  # React组件
│   │   │   ├── Navbar.jsx
│   │   │   └── SearchableSelect.jsx
│   │   ├── pages/      # 页面组件
│   │   │   ├── Home.jsx
│   │   │   ├── PostDetail.jsx
│   │   │   ├── CreatePost.jsx
│   │   │   ├── Profile.jsx
│   │   │   ├── Login.jsx
│   │   │   ├── Register.jsx
│   │   │   └── Leaderboard.jsx
│   │   ├── utils/      # 工具函数
│   │   │   ├── api.js
│   │   │   ├── avatar.js
│   │   │   ├── runeterraTime.js
│   │   │   └── highlightMentions.js
│   │   ├── App.jsx     # 主应用组件
│   │   └── main.jsx    # 入口文件
│   ├── public/
│   │   └── avatar/     # 默认头像目录
│   ├── package.json    # 前端依赖
│   └── vite.config.js  # Vite配置
├── package.json        # 根目录配置
├── README.md          # 项目说明
└── 功能说明.md        # 功能详细说明
```

## API 接口

### 用户相关
- `POST /api/register` - 用户注册
- `POST /api/login` - 用户登录（不存在用户且密码为1234567时自动创建）
- `GET /api/user` - 获取当前用户信息
- `PUT /api/user` - 更新用户信息（头像、用户名、段位、头衔、身份）
- `GET /api/users` - 获取用户列表

### 帖子相关
- `GET /api/posts` - 获取帖子列表（支持分类筛选）
- `GET /api/posts/:id` - 获取单个帖子
- `POST /api/posts` - 创建帖子
- `PUT /api/posts/:id` - 更新帖子
- `DELETE /api/posts/:id` - 删除帖子
- `DELETE /api/posts/all` - 清除所有帖子（需要登录）
- `GET /api/posts/:id/replies` - 获取帖子回复
- `POST /api/posts/:id/replies` - 创建回复
- `PUT /api/replies/:id` - 更新回复
- `DELETE /api/replies/:id` - 删除回复
- `PUT /api/posts/:id/replies/order` - 更新回复顺序
- `POST /api/posts/:id/like` - 点赞/取消点赞
- `GET /api/posts/:id/like` - 检查点赞状态

### 其他
- `GET /api/leaderboard` - 获取用户排行榜
- `GET /api/categories/all` - 获取所有板块分类
- `POST /api/upload-image` - 上传图片

## 使用说明

### 展示模式（正常论坛模式）
1. 浏览帖子列表
2. 查看帖子详情
3. 发表回复（可以选择用户、设置匿名、自定义时间等）
4. 点赞帖子

### 编辑模式（创作模式）
1. 登录后，点击导航栏的"展示模式"按钮切换到"编辑模式"
2. 进入帖子详情页
3. 可以：
   - 编辑帖子信息
   - 拖拽回复楼层调整顺序（自动调整楼层号）
   - 编辑每个回复的内容
   - 选择不同的用户发表回复（支持搜索和自定义用户名）
   - 修改时间、地区、头衔、身份等信息
   - 删除回复
4. 点击"保存所有更改"保存修改

### 发帖时的字段说明
- **发帖人**：从数据库中选择已存在的用户（支持搜索），或使用自定义用户名
- **匿名**：勾选后显示为"匿名用户"，隐藏头衔和身份
- **时间**：留空使用当前时间，或填写瓦罗兰历时间（格式：YY-MM-DD HH:mm，如：25-12-03 11:21）
- **地区**：选择发言人所在地区（艾欧尼亚、德玛西亚等）
- **头衔**：填写头衔（英雄的默认头衔为空）
- **身份**：填写身份（如：版主，英雄的默认身份为空）
- **楼层数**：回复时可以自定义楼层号，留空则自动计数

## 创作建议

1. **先创建用户**：在注册页面创建各个英雄和角色的账号，或使用默认密码1234567登录（不存在会自动创建）
2. **设置用户信息**：在个人资料页面设置每个用户的头像、段位、头衔、身份
3. **添加头像文件**：英雄的话可以将头像文件（jpg/jpeg/webp格式）放入 `client/public/avatar/` 目录，文件名使用英雄的中文名或英文名，普通用户可以直接在profile页面上传
4. **切换到编辑模式**：开始创作时切换到编辑模式
5. **创建帖子**：在编辑模式下创建帖子，可以手动填写所有信息
6. **添加回复**：在编辑模式下添加回复，可以自由选择用户、设置时间、引用其他回复等
7. **调整顺序**：通过拖拽调整回复顺序，系统会自动调整楼层号
8. **保存更改**：完成编辑后保存所有更改
9. **切换到展示模式**：查看最终效果

## 注意事项

1. 编辑模式需要登录才能使用
2. 图片上传限制：头像最大5MB，帖子图片最大50MB
3. 匿名发帖/回复时，用户信息（头衔、身份）会被隐藏
4. 英雄用户的默认头衔和身份为空，需要在发帖/回复时手动填写
5. 默认登录密码为1234567，不存在用户会自动创建
6. 瓦罗兰历时间格式：瓦罗兰历 YY-MM-DD HH:mm（如：瓦罗兰历 25-12-03 11:21）
7. 默认头像文件应放在 `client/public/avatar/` 目录，支持jpg、jpeg、webp格式
8. 清除所有帖子功能会删除所有帖子、回复和点赞数据，请谨慎使用

## 特色功能

- **拟真度高**：完全模拟真实论坛的显示效果
- **创作友好**：编辑模式让创作论坛体变得简单
- **信息丰富**：支持显示头像、段位、头衔、身份、地区、时间等完整信息
- **灵活编辑**：可以自由调整楼层顺序、修改内容、选择用户
- **智能搜索**：用户选择支持搜索功能，快速查找用户
- **记忆功能**：同一帖子中，选择已回复过的用户会自动填充上次的值
- **引用回复**：支持引用其他楼层的回复，显示引用内容
- **楼主标识**：自动识别并显示楼主标识

## 许可证

MIT

祝你创作愉快！欢迎来到班德尔密林！✨
